// room script file

bool wasReminded = false;

function Credits()
{
  Display("Thank you for playing!");
  Display("This was MAGS MAY 2019 submission by...");
  Display("Art - GaeilgeGames\nCreative Writing - Durq\nProgramming - Artium");
  QuitGame(0);
}

function PlayEpilogueSequence()
{
  Credits();
}

function hTrashcan_Interact()
{
  if (player.HasInventory(iReciept)) {
    player.Say("I've already searched the trash can.");

  } else {
    player.Say("Ugh. It stinks, but there's a receipt on top.");
    player.Say("He bought a bunch of food, and what's this? Massage oil? I've never received any massages from him.");
    player.Say("Who is he rubbing?!");
    player.AddInventory(iReciept);
    Reciept.Enable(); 
    Clues.Found(eClueReciept);
  }
}

function hTrashcan_Look()
{
  if (player.HasInventory(iReciept)) {
    player.Say("I've already searched the trash can.");

  } else {
    player.Say("That's his garbage can. Maybe there's something incriminating in there.");
  }
}

//function CalculateLookReaction( );// TODO

function hMainWindow_Interact()
{
  player.Say("I can't open the window.");
}

function hMainWindow_Look()
{
  if (Reciept.HasSelection() == true) { // Some items selected in the list
    
    if (Reciept.ItemsSelectedForClue(eClueChampagne) == false) {
      player.Say("That doesn’t make sense.");
    } else { // The combination is correct
      if (Clues.IsAlreadyFound(eClueChampagne)) { // Found clue in the past
        player.Say("I already know that this is a champagne bottle in the window.");
      } else {
        player.Say("Is that a champagne bottle?");
        player.Say("That son of a bitch must be planning to wine and dine some young tart.");
        player.Say(" That bastard is going down!");
        Clues.Found(eClueChampagne);
      }
    }    
  } else { // Nothing selected in the item list
    
    if (Clues.IsAlreadyFound(eClueChampagne)) { // Found clue
      player.Say("That is a champagne bottle in the window.");
    } else { // Not found clue
      player.Say("I can’t make out what that is.");
    }
  }
}

function hKitchenWindow_Interact()
{
  player.Say("I can't open the window.");
  if (Clues.IsAlreadyFound(eClueCake)) {
     player.Say("I already know what's cooking.");
  } else {
    player.Say("There's a smell coming out of the kitchen, but he doesn't cook.");
    player.Say("He must have some tramp in there cooking for him.");
  }
}

function hKitchenWindow_Look()
{
  if (Reciept.HasSelection() == true) { // Some items selected in the list

    if (Reciept.PartialItemsSelectedForClue(eClueCake) == false) {
      player.Say("That doesn’t make sense.");
    } else if (Reciept.ItemsSelectedForClue(eClueCake) == false) {
      player.Say("Something is missing here...");
    } else { // The combination is correct
      if (Clues.IsAlreadyFound(eClueCake)) { // Found clue in the past
        player.Say("I already know what's cooking.");
      } else {
        player.Say("CAKE TODO TODO");
        Clues.Found(eClueCake);
      }
    }    
  } else { // Nothing selected in the item list
    
    if (Clues.IsAlreadyFound(eClueCake)) { // Found clue
      player.Say("I already know what's cooking.");
    } else { // Not found clue
      player.Say("That's the kitchen window. The blinds are down.");
    }
  }
  
  
}

function hDoor_Interact()
{

  if(Clues.IsComplete()) {
    PlayEpilogueSequence();
  } else {
    player.Say("I am not ready to confront him yet."); // TODO: Refine
    player.Say("I want to figure out what is going on first."); // TODO: Refine
  }

}

function hDoor_Look()
{
  if(Clues.IsComplete()) {
    player.Say("There is no choise left!");
    return;
  }
  
  if (Reciept.HasSelection() == true) { // Some items selected in the list
    
    if (Reciept.ItemsSelectedForClue(eClueMusic) == false) {
      player.Say("That doesn’t make sense.");
    } else { // The combination is correct
      if (Clues.IsAlreadyFound(eClueMusic)) { // Found clue in the past
        player.Say("I already know that he is playing the Usher CD.");
      } else {
        player.Say("He’s playing the Usher CD!?");
        player.Say("He must be getting ready to sex up another woman.");
        player.Say("This is unbelievable!");
        Clues.Found(eClueMusic);
      }
    }    
  } else { // Nothing selected in the item list
    
    if (Clues.IsAlreadyFound(eClueMusic)) { // Found clue
      player.Say("He’s playing the Usher CD.");
    } else { // Not found clue
        player.Say("There’s some music playing, but I can’t quite tell what song it is.");
    }
  }
}

function room_FirstLoad()
{
  SetTimer(1, 5 * 60 * GetGameSpeed());
  
  player.Say("My boyfriend has been really short with me all day.");

  player.Say("Something's up. I can't shake the feeling that he's cheating on me");

  Wait(GetGameSpeed() * 4);
  player.Say("And now he's not answering my texts.");
  //Wait(GetGameSpeed() * 1);
  player.Say("This might be a little nuts, but if he's cheating, I'm going to catch him in the act.");
  player.Say("I NEED to know!");
}

function repeatedly_execute_always() {
  
  /**
   *  Leave only door interactable when all the clues were found
   */
  if(Clues.IsComplete()) {
    Reciept.Disable();
    
    // 
    hMainWindow.Enabled = false;
    hKitchenWindow.Enabled = false;
    hTrashcan.Enabled = false;
  }  
  
  /** 
   * Display gameplay reminder after some duration
   * Little help for stuck players
   */
   if (IsTimerExpired(1) && Clues.CountFound() == 1 && wasReminded == false) {
      Display("Gameplay reminder: \nLeft Mouse - Look\nRight Mouse - Interact");
      wasReminded = true;
   }
}



